<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¯æ—¥åœ°ç†æ—©è¯»</title>
    <!-- å¼•å…¥å›½å†…æœ€å¿«çš„ Quill ç¼–è¾‘å™¨èµ„æº -->
    <link href="https://cdn.bootcdn.net/ajax/libs/quill/1.3.6/quill.snow.min.css" rel="stylesheet">
    <style>
        /* å…¨å±€æ ·å¼åˆå§‹åŒ– */
        body { font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; background-color: #f4f6f9; margin: 0; padding: 20px; color: #333; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        
        /* é¡¶éƒ¨æ—¶é—´ */
        .header { text-align: center; border-bottom: 2px solid #eee; padding-bottom: 20px; margin-bottom: 20px; }
        #current-date { font-size: 1.1em; color: #7f8c8d; margin-bottom: 5px; }
        #current-time { font-size: 2.5em; font-weight: bold; color: #2c3e50; font-family: monospace; }

        /* é¡µé¢åˆ‡æ¢é€»è¾‘ */
        .page { display: none; animation: fadeIn 0.4s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* å†…å®¹æ¡†æ ·å¼ */
        .content-display { min-height: 200px; padding: 15px; border: 1px solid #e0e0e0; border-radius: 6px; background: #fff; }
        .ql-editor { padding: 0; } /* ä¿®æ­£ç¼–è¾‘å™¨å†…è¾¹è· */

        /* æŒ‰é’®æ ·å¼ */
        .btn { display: block; width: 100%; padding: 15px; margin-top: 20px; background-color: #3498db; color: white; border: none; border-radius: 8px; font-size: 1.1em; cursor: pointer; transition: 0.3s; }
        .btn:hover { background-color: #2980b9; }
        .btn-secondary { background-color: #95a5a6; }
        .btn-secondary:hover { background-color: #7f8c8d; }

        /* é»˜å†™é”å®šæ ·å¼ */
        .lock-box { background: #fff3cd; color: #856404; padding: 40px; text-align: center; border-radius: 8px; border: 2px dashed #ffeeba; }

        /* --- æ•™å¸ˆåå° (å…³é”®ï¼šå¼ºåˆ¶éšè—ï¼Œé˜²æ­¢å­¦ç”Ÿçœ‹åˆ°) --- */
        #admin-panel { 
            display: none !important; /* åŠ ä¸Š !important ç¡®ä¿é»˜è®¤ç»å¯¹éšè— */
            margin-top: 60px; padding-top: 20px; border-top: 5px solid #3498db; background: #fcfcfc; 
        }

        /* ç¼–è¾‘å™¨é«˜åº¦ */
        .editor-box { height: 200px; background: white; }
        
        /* éšå½¢ç™»å½•ç‚¹ */
       .login-dot { 
    position: fixed; 
    bottom: 10px; 
    right: 10px; 
    padding: 5px 10px;
    background: #eee; /* ç°è‰²èƒŒæ™¯ */
    color: #999;      /* ç°è‰²æ–‡å­— */
    font-size: 12px;
    border-radius: 4px;
    cursor: pointer; 
    z-index: 999; 
    opacity: 0.5;     /* åŠé€æ˜ */
}
.login-dot:hover {
    opacity: 1;       /* é¼ æ ‡æ”¾ä¸Šå»å˜æ¸…æ¥š */
    background: #ddd;
}
    </style>
</head>
<body>

<div class="container">
    <!-- 1. æ—¶é—´æ˜¾ç¤º -->
    <div class="header">
        <div id="current-date">æ­£åœ¨åŠ è½½æ—¥æœŸ...</div>
        <div id="current-time">00:00:00</div>
    </div>

    <!-- 2. å­¦ç”Ÿçœ‹çš„ç¬¬ä¸€é¡µï¼šæ—©è¯» -->
    <div id="page-read" class="page active">
        <h2 style="color:#2c3e50">ğŸ“– ä»Šæ—¥æ—©è¯»ä»»åŠ¡</h2>
        <div id="view-reading" class="content-display ql-editor">
            <p style="text-align:center; color:#999; margin-top:50px;">æ­£åœ¨è¿æ¥äº‘ç«¯è·å–ä»»åŠ¡...</p>
        </div>
        <button class="btn" onclick="switchPage('write')">å®Œæˆæ—©è¯»ï¼Œè¿›å…¥é»˜å†™æ£€æµ‹ â†’</button>
    </div>

    <!-- 3. å­¦ç”Ÿçœ‹çš„ç¬¬äºŒé¡µï¼šé»˜å†™ -->
    <div id="page-write" class="page">
        <h2 style="color:#c0392b">âœï¸ é»˜å†™æ£€æµ‹</h2>
        
        <!-- é”å®šçŠ¶æ€ -->
        <div id="lock-msg" class="lock-box">
            <div style="font-size:2em; margin-bottom:10px;">ğŸ”’</div>
            é»˜å†™å°†åœ¨ <strong id="unlock-time-display">--:--</strong> å¼€å¯
        </div>

        <!-- è§£é”çŠ¶æ€ -->
        <div id="view-writing" class="content-display ql-editor" style="display:none;"></div>

        <button class="btn btn-secondary" onclick="switchPage('read')">â† è¿”å›æ—©è¯»ä»»åŠ¡</button>
    </div>

    <!-- 4. è€å¸ˆåå° (é»˜è®¤çœ‹ä¸è§) -->
    <div id="admin-panel">
        <h3>ğŸ”§ è€å¸ˆå‘å¸ƒåå°</h3>
        <p><strong>æ—©è¯»å†…å®¹ï¼š</strong></p>
        <div id="edit-reading" class="editor-box"></div>
        
        <p style="margin-top:50px;"><strong>é»˜å†™å†…å®¹ï¼š</strong></p>
        <div id="edit-writing" class="editor-box"></div>
        
        <div style="margin-top:20px; padding:15px; background:#e8f4fc; border-radius:5px;">
            <label>â° é»˜å†™å¼€å¯æ—¶é—´ï¼š</label>
            <input type="time" id="time-input" style="padding:5px; font-size:1.1em;">
            <button class="btn" style="background:#27ae60; margin-top:10px;" onclick="publishData()">â˜ï¸ ç«‹å³å‘å¸ƒåˆ°äº‘ç«¯</button>
        </div>
    </div>

</div>

<!-- éšå½¢æŒ‰é’® -->
<div class="login-dot" onclick="adminLogin()">è€å¸ˆç™»å½•</div>

<!-- å¼•å…¥è„šæœ¬åº“ -->
<script src="https://cdn.bootcdn.net/ajax/libs/quill/1.3.6/quill.min.js"></script>
<script src="//code.bdstatic.com/npm/leancloud-storage@4.12.0/dist/av-min.js"></script>

<script>
    // ============================================================
    // â¬‡ï¸â¬‡ï¸â¬‡ï¸ è¯·åœ¨è¿™é‡Œå¡«å…¥ä½ ã€ç¬¬äºŒé˜¶æ®µã€‘è·å–çš„æ–°å¯†é’¥ â¬‡ï¸â¬‡ï¸â¬‡ï¸
    // ============================================================
    const APP_ID  = 'HLrQMs565wIqaIvFLCWezXKI-MdYXbMMI';
    const APP_KEY = 'UpLSsS0moovxKPRy4om5uOiT';
    const SERVER  = 'https://hlrqms56.api.lncldglobal.com'; // æ³¨æ„ï¼šå¿…é¡»æ˜¯ https:// å¼€å¤´
    // ============================================================

    // 1. åˆå§‹åŒ–äº‘ç«¯
    AV.init({ appId: APP_ID, appKey: APP_KEY, serverURL: SERVER });

    // 2. é¡µé¢åŠ è½½é€»è¾‘
    let quillR, quillW;
    window.onload = function() {
        // åˆå§‹åŒ–ç¼–è¾‘å™¨
        var tools = [[{ 'header': [1, 2, false] }], ['bold', 'italic', { 'color': [] }], [{ 'list': 'ordered'}, { 'list': 'bullet' }]];
        quillR = new Quill('#edit-reading', { theme: 'snow', modules: { toolbar: tools } });
        quillW = new Quill('#edit-writing', { theme: 'snow', modules: { toolbar: tools } });

        // å¯åŠ¨æ—¶é’Ÿ
        setInterval(updateClock, 1000);
        updateClock();

        // æ‹‰å–äº‘ç«¯æ•°æ®
        fetchData();
    };

    // 3. æ‹‰å–æ•°æ® (è¯»)
    function fetchData() {
        const query = new AV.Query('TaskData');
        query.descending('createdAt'); // è·å–æœ€æ–°çš„ä¸€æ¡
        query.first().then((data) => {
            if (data) {
                const attr = data.attributes;
                // æ›´æ–°å­¦ç”Ÿçœ‹çš„åœ°æ–¹
                document.getElementById('view-reading').innerHTML = attr.reading;
                document.getElementById('view-writing').innerHTML = attr.writing;
                document.getElementById('unlock-time-display').innerText = attr.unlockTime;
                
                // æ›´æ–°è€å¸ˆçœ‹çš„åœ°æ–¹ (æ–¹ä¾¿ä¿®æ”¹)
                quillR.root.innerHTML = attr.reading;
                quillW.root.innerHTML = attr.writing;
                document.getElementById('time-input').value = attr.unlockTime;

                // æ£€æŸ¥æ˜¯å¦è§£é”
                checkLock();
            } else {
                document.getElementById('view-reading').innerHTML = "<p style='text-align:center'>æš‚æ— å‘å¸ƒä»»åŠ¡</p>";
            }
        }, (error) => {
            console.error(error);
            // å¦‚æœå‡ºé”™ï¼Œåªåœ¨æ§åˆ¶å°æ˜¾ç¤ºï¼Œä¸å¼¹çª—æ‰“æ‰°å­¦ç”Ÿï¼Œé™¤éæ˜¯ä¸¥é‡é…ç½®é”™è¯¯
            if(error.code === 403) alert("âš ï¸ æƒé™é”™è¯¯ï¼šè¯·æ£€æŸ¥ LeanCloud ç™½åå•è®¾ç½®ï¼");
        });
    }

    // 4. å‘å¸ƒæ•°æ® (å†™)
    function publishData() {
        const TaskData = AV.Object.extend('TaskData');
        const task = new TaskData();
        
        const r_html = quillR.root.innerHTML;
        const w_html = quillW.root.innerHTML;
        const time   = document.getElementById('time-input').value;

        if(!time) { alert("è¯·è®¾ç½®ä¸€ä¸ªé»˜å†™å¼€å¯æ—¶é—´ï¼"); return; }

        task.set('reading', r_html);
        task.set('writing', w_html);
        task.set('unlockTime', time);

        const btn = document.querySelector('button[onclick="publishData()"]');
        btn.innerText = "æ­£åœ¨å‘é€...";
        
        task.save().then(() => {
            alert("âœ… å‘å¸ƒæˆåŠŸï¼\n\nè¯·å»å¦ä¸€å°ç”µè„‘åˆ·æ–°æŸ¥çœ‹æ•ˆæœã€‚");
            btn.innerText = "â˜ï¸ ç«‹å³å‘å¸ƒåˆ°äº‘ç«¯";
            window.location.reload(); // åˆ·æ–°é¡µé¢ç¡®è®¤æ•ˆæœ
        }, (error) => {
            alert("âŒ å‘å¸ƒå¤±è´¥: " + error.message);
            btn.innerText = "â˜ï¸ ç«‹å³å‘å¸ƒåˆ°äº‘ç«¯";
        });
    }

    // 5. å…¶ä»–é€»è¾‘
    function updateClock() {
        const now = new Date();
        document.getElementById('current-date').innerText = now.toLocaleDateString('zh-CN', {month:'long', day:'numeric', weekday:'long'});
        document.getElementById('current-time').innerText = now.toLocaleTimeString('zh-CN', {hour12:false});
        checkLock();
    }

    function checkLock() {
        const setTime = document.getElementById('unlock-time-display').innerText;
        if (!setTime || setTime.includes('--')) return;

        const now = new Date();
        const curTime = now.getHours().toString().padStart(2,'0') + ":" + now.getMinutes().toString().padStart(2,'0');

        if (curTime >= setTime) {
            document.getElementById('lock-msg').style.display = 'none';
            document.getElementById('view-writing').style.display = 'block';
        } else {
            document.getElementById('lock-msg').style.display = 'block';
            document.getElementById('view-writing').style.display = 'none';
        }
    }

    function switchPage(pageName) {
        document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
        document.getElementById('page-' + pageName).classList.add('active');
    }

    function adminLogin() {
        const pwd = prompt("è¯·è¾“å…¥è€å¸ˆå¯†ç ï¼š");
        if (pwd === "8888") {
            // åªæœ‰å¯†ç æ­£ç¡®ï¼Œæ‰å¼ºåˆ¶æ˜¾ç¤ºåå°
            document.getElementById('admin-panel').style.setProperty('display', 'block', 'important');
            // è‡ªåŠ¨æ»šåˆ°åº•éƒ¨
            setTimeout(() => window.scrollTo(0, document.body.scrollHeight), 100);
        }
    }
</script>
</body>
</html>
